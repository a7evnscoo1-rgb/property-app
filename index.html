<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="‰∏çÂãïÁî£ÊäïË≥á„ÅÆÂà§Êñ≠„ÉÑ„Éº„É´">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <title>Áâ©‰ª∂Âà§Êñ≠„Ç¢„Éó„É™</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e27;
            color: #f9fafb;
            position: relative;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            animation: pulse 15s ease-in-out infinite;
            z-index: 0;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .app-header {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(20px);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .app-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            background: rgba(31, 41, 55, 0.5);
            padding: 5px;
            border-radius: 12px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: #9ca3af;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin: 20px 0 15px 0;
            color: #e5e7eb;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 8px;
        }
        
        .form-group { margin-bottom: 15px; }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e5e7eb;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="checkbox"],
        select {
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 15px;
            background: rgba(31, 41, 55, 0.5);
            color: #f9fafb;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
        }
        
        input[type="number"] { text-align: right; }
        
        input:focus, select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6);
        }
        
        .btn-secondary {
            background: rgba(75, 85, 99, 0.5);
            color: #e5e7eb;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(75, 85, 99, 0.8);
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .result-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(31, 41, 55, 0.6);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .result-item {
            text-align: center;
            padding: 15px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
        }
        
        .result-label {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .result-value {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .result-value.large { font-size: 32px; }
        
        .alert {
            background: rgba(239, 68, 68, 0.2);
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #fca5a5;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border-left: 4px solid #10b981;
            color: #6ee7b7;
        }
        
        .property-list {
            margin-top: 20px;
        }
        
        .property-item {
            background: rgba(31, 41, 55, 0.5);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .property-item:hover {
            background: rgba(31, 41, 55, 0.8);
        }
        
        .property-info {
            flex: 1;
        }
        
        .property-name {
            font-size: 16px;
            font-weight: 700;
            color: #e5e7eb;
            margin-bottom: 5px;
        }
        
        .property-details {
            font-size: 13px;
            color: #9ca3af;
        }
        
        .property-price {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-right: 15px;
        }
        
        .property-actions {
            display: flex;
            gap: 8px;
        }
        
        .hidden { display: none !important; }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .toolbar {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        input[type="file"] {
            display: none;
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .result-grid { grid-template-columns: 1fr; }
            .property-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .property-actions {
                width: 100%;
            }
            .btn-small {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="app-title">üè† Áâ©‰ª∂Âà§Êñ≠„Ç¢„Éó„É™</div>
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('simple')">üìä Á∞°ÊòìÂà§Êñ≠</button>
                <button class="tab-btn" onclick="switchTab('detailed')">üìà Ë©≥Á¥∞ÂàÜÊûê</button>
                <button class="tab-btn" onclick="switchTab('saved')">üíæ ‰øùÂ≠òÊ∏à„Åø</button>
            </div>
        </div>
        
        <!-- Á∞°ÊòìÁâà„Çø„Éñ -->
        <div id="simpleTab" class="tab-content active">
            <div class="card">
                <h2 style="color: #e5e7eb; margin-bottom: 20px;">Á¥†Êó©„ÅèÊé®Â•®Ë≥ºÂÖ•‰æ°Ê†º„ÇíË®àÁÆó</h2>
                
                <div class="form-group">
                    <label>Áâ©‰ª∂Âêç</label>
                    <input type="text" id="s_name" placeholder="‰æãÔºöÁ•ûÊà∏Â∏ÇË•øÂå∫Â≤©Â≤°Áî∫">
                </div>
                
                <div class="form-group">
                    <label>ÊÉ≥ÂÆöÂÆ∂Ë≥ÉÔºàÊúàÈ°ç„ÉªÂÜÜÔºâ</label>
                    <input type="number" id="s_rent" value="55000">
                </div>
                
                <div class="form-group">
                    <label>ÁõÆÊ®ôË°®Èù¢Âà©Âõû„ÇäÔºà%Ôºâ</label>
                    <input type="number" id="s_yield" value="13" step="0.1">
                </div>
                
                <div class="form-group">
                    <label>„É™„Éï„Ç©„Éº„É†Ë≤ªÁî®ÔºàÂÜÜÔºâ</label>
                    <input type="number" id="s_reform" value="1700000">
                </div>
                
                <button class="btn btn-primary" onclick="calcSimple()">üí° Ë®àÁÆó„Åô„Çã</button>
                
                <div id="s_result" class="result-section hidden">
                    <div class="result-item">
                        <div class="result-label">Âπ¥ÈñìÂÆ∂Ë≥ÉÂèéÂÖ•</div>
                        <div class="result-value" id="s_annual"></div>
                    </div>
                    <div class="result-item" style="margin-top: 20px;">
                        <div class="result-label">Êé®Â•®Áâ©‰ª∂Ë≥ºÂÖ•‰æ°Ê†º</div>
                        <div class="result-value large" id="s_price"></div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSimple()">üíæ ‰øùÂ≠ò„Åô„Çã</button>
                </div>
            </div>
        </div>
        
        <!-- Ë©≥Á¥∞Áâà„Çø„ÉñÔºàÂâçÂõû„Å®Âêå„Åò„Ç≥„Éº„Éâ„ÇíÁ∂ôÁ∂öÔºâ -->
        <div id="detailedTab" class="tab-content">
            <div class="card">
                <h2 style="color: #e5e7eb; margin-bottom: 10px;">Ë©≥Á¥∞„Å™ÂèéÊîØ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</h2>
                
                <div class="form-group">
                    <label>Áâ©‰ª∂Âêç</label>
                    <input type="text" id="d_name" placeholder="‰æãÔºöÁ•ûÊà∏Â∏ÇË•øÂå∫Â≤©Â≤°Áî∫">
                </div>
                
                <div class="section-title">Âü∫Êú¨ÊÉÖÂ†±</div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Áâ©‰ª∂‰æ°Ê†ºÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_price" value="2500000">
                    </div>
                    <div class="form-group">
                        <label>„É™„Éï„Ç©„Éº„É†Ë≤ªÁî®ÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_reform" value="1700000">
                    </div>
                    <div class="form-group">
                        <label>ÊÉ≥ÂÆöÂÆ∂Ë≥ÉÔºàÊúàÈ°ç„ÉªÂÜÜÔºâ</label>
                        <input type="number" id="d_rent" value="55000">
                    </div>
                    <div class="form-group">
                        <label>Á©∫ÂÆ§ÁéáÔºà%Ôºâ</label>
                        <input type="number" id="d_vacancy" value="15">
                    </div>
                </div>
                
                <div class="section-title">ÂúüÂú∞ÂÄ§Ë®àÁÆó</div>
                <div class="form-group">
                    <label>ÂúüÂú∞Èù¢Á©çÔºà„é°Ôºâ</label>
                    <input type="number" id="d_landArea" value="72.31" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ë©ï‰æ°ÊñπÊ≥ï</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="landMethod" value="inheritance" checked onchange="toggleLandMethod()">
                            Áõ∏Á∂öÁ®éË∑ØÁ∑ö‰æ°
                        </label>
                        <label>
                            <input type="radio" name="landMethod" value="property" onchange="toggleLandMethod()">
                            Âõ∫ÂÆöË≥áÁî£Á®éË©ï‰æ°È°ç/„é°
                        </label>
                    </div>
                </div>
                <div id="inheritanceInput">
                    <div class="form-group">
                        <label>Áõ∏Á∂öÁ®éË∑ØÁ∑ö‰æ°ÔºàÂÜÜ/„é°Ôºâ</label>
                        <input type="number" id="d_inheritance" value="50000">
                    </div>
                </div>
                <div id="propertyInput" class="hidden">
                    <div class="form-group">
                        <label>Âõ∫ÂÆöË≥áÁî£Á®éË©ï‰æ°È°çÔºàÂÜÜ/„é°Ôºâ</label>
                        <input type="number" id="d_propertyValue" value="31800">
                    </div>
                </div>
                
                <div class="section-title">Ë´∏Ë≤ªÁî®</div>
                <div class="form-group">
                    <label>ÂÖ•ÂäõÊñπÊ≥ï</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="costMethod" value="fixed" checked onchange="toggleCostMethod()">
                            Âõ∫ÂÆöÈ°çÂÖ•Âäõ
                        </label>
                        <label>
                            <input type="radio" name="costMethod" value="detail" onchange="toggleCostMethod()">
                            ÂÄãÂà•ÂÖ•Âäõ
                        </label>
                    </div>
                </div>
                <div id="fixedCostInput">
                    <div class="form-group">
                        <label>Ë´∏Ë≤ªÁî®ÂêàË®àÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_costFixed" value="552000">
                    </div>
                </div>
                <div id="detailCostInput" class="hidden">
                    <div class="form-group">
                        <label>ÂúüÂú∞Ë©ï‰æ°È°çÔºàÂÜÜÔºâ‚ÄªÁôªË®òË≤ªÁî®Ë®àÁÆóÁî®</label>
                        <input type="number" id="d_landValue" value="2298000" onchange="calcDetailCosts()">
                    </div>
                    <div class="form-group">
                        <label>‰ª≤‰ªãÊâãÊï∞Êñô</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="brokerageMethod" value="auto" checked onchange="toggleBrokerage()">
                                Ëá™ÂãïË®àÁÆó
                            </label>
                            <label>
                                <input type="radio" name="brokerageMethod" value="max" onchange="toggleBrokerage()">
                                ‰∏äÈôê33‰∏áÂÜÜ
                            </label>
                            <label>
                                <input type="radio" name="brokerageMethod" value="manual" onchange="toggleBrokerage()">
                                ÊâãÂÖ•Âäõ
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="number" id="d_brokerage" readonly style="background: rgba(75, 85, 99, 0.3);">
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>ÁôªÈå≤ÂÖçË®±Á®éÔºàËá™ÂãïË®àÁÆóÔºâ</label>
                            <input type="number" id="d_regTax" readonly style="background: rgba(75, 85, 99, 0.3);">
                        </div>
                        <div class="form-group">
                            <label>ÊâÄÊúâÊ®©ÁßªËª¢ÁôªË®òË≤ªÁî®ÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_transfer" value="0">
                        </div>
                        <div class="form-group">
                            <label>Âè∏Ê≥ïÊõ∏Â£´Â†±ÈÖ¨ÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_lawyer" value="100000">
                        </div>
                        <div class="form-group">
                            <label>Âõ∫ÈÉΩÁ®éÊ∏ÖÁÆóÈáëÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_taxAdj" value="10000">
                        </div>
                        <div class="form-group">
                            <label>ÁÅ´ÁÅΩ‰øùÈô∫Êñô„ÉªÂàùÊúüÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_insurance0" value="30000">
                        </div>
                        <div class="form-group">
                            <label>„É≠„Éº„É≥‰øùË®ºÊñôÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_guarantee" value="25000">
                        </div>
                        <div class="form-group">
                            <label>„É≠„Éº„É≥‰∫ãÂãôÊâãÊï∞ÊñôÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_loanFee" value="33000">
                        </div>
                        <div class="form-group">
                            <label>ÂÆ∂Ë≥É‰øùË®º„ÉªÂàùÂõûÔºàÂÜÜÔºâ</label>
                            <input type="number" id="d_guaranteeInitial" value="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>„Åù„ÅÆ‰ªñË´∏Ë≤ªÁî®ÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_other" value="0">
                    </div>
                </div>
                
                <div class="section-title">„É≠„Éº„É≥ÊÉÖÂ†±</div>
                <div class="grid-3">
                    <div class="form-group">
                        <label>„É≠„Éº„É≥ÈáëÈ°çÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_loan" value="1700000">
                    </div>
                    <div class="form-group">
                        <label>ÈáëÂà©Ôºà%Ôºâ</label>
                        <input type="number" id="d_rate" value="3" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>ËøîÊ∏àÂπ¥Êï∞</label>
                        <input type="number" id="d_years" value="10">
                    </div>
                </div>
                
                <div class="section-title">Âπ¥Èñì„É©„É≥„Éã„É≥„Ç∞„Ç≥„Çπ„Éà</div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>ÁÆ°ÁêÜÂßîË®óË≤ªÁéáÔºà%Ôºâ</label>
                        <input type="number" id="d_mgmtRate" value="5" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>ÁÅ´ÁÅΩ‰øùÈô∫Êñô„ÉªÂπ¥È°çÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_insurance" value="30000">
                    </div>
                    <div class="form-group">
                        <label>Âõ∫ÈÉΩÁ®é„ÉªÂπ¥È°çÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_tax" value="50000">
                    </div>
                    <div class="form-group">
                        <label>‰øÆÁπïÁ©çÁ´ãÈáë„ÉªÂπ¥È°çÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_repair" value="100000">
                    </div>
                    <div class="form-group">
                        <label>ÂÆ∂Ë≥É‰øùË®º„ÉªÊõ¥Êñ∞ÊñôÔºàÂÜÜÔºâ</label>
                        <input type="number" id="d_guaranteeAnnual" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>„Åù„ÅÆ‰ªñ„ÉªÂπ¥È°çÔºàÂÜÜÔºâ</label>
                    <input type="number" id="d_otherCost" value="0">
                </div>
                
                <button class="btn btn-primary" onclick="calcDetailed()">üìä „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÂÆüË°å</button>
                
                <div id="d_result" class="result-section hidden">
                    <div id="paymentAlert"></div>
                    
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">ÂúüÂú∞ÂÄ§</div>
                            <div class="result-value" id="d_landVal"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Ë°®Èù¢Âà©Âõû„Çä</div>
                            <div class="result-value" id="d_gross"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ÂÆüË≥™Âà©Âõû„Çä</div>
                            <div class="result-value" id="d_net"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ËøîÊ∏àÊØîÁéá</div>
                            <div class="result-value" id="d_ratio"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Âπ¥ÈñìCF</div>
                            <div class="result-value" id="d_cfYear"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ÊúàÈñìCF</div>
                            <div class="result-value" id="d_cfMonth"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ÊäïË≥áÂõûÂèéÂπ¥Êï∞</div>
                            <div class="result-value" id="d_payback"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Á∑èÊäïË≥áÈ°ç</div>
                            <div class="result-value" id="d_total"></div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveDetailed()">üíæ ‰øùÂ≠ò„Åô„Çã</button>
                </div>
            </div>
        </div>
        
        <!-- ‰øùÂ≠òÊ∏à„Åø„Çø„Éñ -->
        <div id="savedTab" class="tab-content">
            <div class="card">
                <h2 style="color: #e5e7eb; margin-bottom: 20px;">‰øùÂ≠òÊ∏à„ÅøÁâ©‰ª∂</h2>
                
                <div id="propertyList" class="property-list"></div>
                
                <div id="emptyState" class="empty-state">
                    „Åæ„Å†Áâ©‰ª∂„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                </div>
                
                <div class="toolbar">
                    <button class="btn btn-secondary" onclick="exportData()">üì• „Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ „Ç§„É≥„Éù„Éº„Éà</button>
                </div>
                <input type="file" id="importFile" accept=".json" onchange="importData(event)">
            </div>
        </div>
    </div>
    
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').catch(e => console.log(e));
        }
        
        let properties = [];
        let currentSimpleCalc = null;
        let currentDetailedCalc = null;
        
        window.onload = function() {
            loadProperties();
            renderPropertyList();
        };
        
        function fmt(v) { return '¬•' + Math.round(v).toLocaleString(); }
        
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = ['simpleTab', 'detailedTab', 'savedTab'];
            
            if (tab === 'simple') {
                tabs[0].classList.add('active');
                document.getElementById('simpleTab').classList.add('active');
            } else if (tab === 'detailed') {
                tabs[1].classList.add('active');
                document.getElementById('detailedTab').classList.add('active');
            } else {
                tabs[2].classList.add('active');
                document.getElementById('savedTab').classList.add('active');
                renderPropertyList();
            }
        }
        
        function toggleLandMethod() {
            const method = document.querySelector('input[name="landMethod"]:checked').value;
            document.getElementById('inheritanceInput').classList.toggle('hidden', method !== 'inheritance');
            document.getElementById('propertyInput').classList.toggle('hidden', method !== 'property');
        }
        
        function toggleCostMethod() {
            const method = document.querySelector('input[name="costMethod"]:checked').value;
            document.getElementById('fixedCostInput').classList.toggle('hidden', method !== 'fixed');
            document.getElementById('detailCostInput').classList.toggle('hidden', method !== 'detail');
            if (method === 'detail') calcDetailCosts();
        }
        
        function toggleBrokerage() {
            const method = document.querySelector('input[name="brokerageMethod"]:checked').value;
            const input = document.getElementById('d_brokerage');
            
            if (method === 'manual') {
                input.readOnly = false;
                input.style.background = 'rgba(31, 41, 55, 0.5)';
                input.value = '';
            } else {
                input.readOnly = true;
                input.style.background = 'rgba(75, 85, 99, 0.3)';
                calcDetailCosts();
            }
        }
        
        function calcDetailCosts() {
            const price = parseFloat(document.getElementById('d_price').value) || 0;
            const landVal = parseFloat(document.getElementById('d_landValue').value) || 0;
            const method = document.querySelector('input[name="brokerageMethod"]:checked').value;
            
            let brokerage = 0;
            if (method === 'auto') {
                brokerage = (price * 0.03 + 60000) * 1.1;
            } else if (method === 'max') {
                brokerage = 330000;
            }
            
            if (method !== 'manual') {
                document.getElementById('d_brokerage').value = Math.round(brokerage);
            }
            
            const regTax = landVal * 0.02;
            document.getElementById('d_regTax').value = Math.round(regTax);
        }
        
        function calcSimple() {
            const rent = parseFloat(document.getElementById('s_rent').value) || 0;
            const yld = parseFloat(document.getElementById('s_yield').value) || 0;
            const reform = parseFloat(document.getElementById('s_reform').value) || 0;
            
            const annual = rent * 12;
            const total = annual / (yld / 100);
            const price = total - reform;
            
            currentSimpleCalc = {
                rent, yield: yld, reform, annual, price
            };
            
            document.getElementById('s_annual').textContent = fmt(annual);
            document.getElementById('s_price').textContent = fmt(price);
            document.getElementById('s_result').classList.remove('hidden');
        }
        
        function calcDetailed() {
            const price = parseFloat(document.getElementById('d_price').value) || 0;
            const reform = parseFloat(document.getElementById('d_reform').value) || 0;
            const rent = parseFloat(document.getElementById('d_rent').value) || 0;
            const vacancy = parseFloat(document.getElementById('d_vacancy').value) || 0;
            const loan = parseFloat(document.getElementById('d_loan').value) || 0;
            const rate = parseFloat(document.getElementById('d_rate').value) || 0;
            const years = parseFloat(document.getElementById('d_years').value) || 0;
            
            // ÂúüÂú∞ÂÄ§
            const landArea = parseFloat(document.getElementById('d_landArea').value) || 0;
            const method = document.querySelector('input[name="landMethod"]:checked').value;
            let landValue = 0;
            if (method === 'inheritance') {
                const inh = parseFloat(document.getElementById('d_inheritance').value) || 0;
                landValue = inh * landArea;
            } else {
                const prop = parseFloat(document.getElementById('d_propertyValue').value) || 0;
                landValue = prop * landArea;
            }
            
            // Ë´∏Ë≤ªÁî®
            const costMethod = document.querySelector('input[name="costMethod"]:checked').value;
            let totalCost = 0;
            if (costMethod === 'fixed') {
                totalCost = parseFloat(document.getElementById('d_costFixed').value) || 0;
            } else {
                totalCost = 
                    (parseFloat(document.getElementById('d_brokerage').value) || 0) +
                    (parseFloat(document.getElementById('d_regTax').value) || 0) +
                    (parseFloat(document.getElementById('d_transfer').value) || 0) +
                    (parseFloat(document.getElementById('d_lawyer').value) || 0) +
                    (parseFloat(document.getElementById('d_taxAdj').value) || 0) +
                    (parseFloat(document.getElementById('d_insurance0').value) || 0) +
                    (parseFloat(document.getElementById('d_guarantee').value) || 0) +
                    (parseFloat(document.getElementById('d_loanFee').value) || 0) +
                    (parseFloat(document.getElementById('d_guaranteeInitial').value) || 0) +
                    (parseFloat(document.getElementById('d_other').value) || 0);
            }
            
            // „É©„É≥„Éã„É≥„Ç∞„Ç≥„Çπ„Éà
            const mgmtRate = parseFloat(document.getElementById('d_mgmtRate').value) || 0;
            const mgmt = rent * 12 * (mgmtRate / 100);
            const ins = parseFloat(document.getElementById('d_insurance').value) || 0;
            const tax = parseFloat(document.getElementById('d_tax').value) || 0;
            const repair = parseFloat(document.getElementById('d_repair').value) || 0;
            const guaranteeAnnual = parseFloat(document.getElementById('d_guaranteeAnnual').value) || 0;
            const other = parseFloat(document.getElementById('d_otherCost').value) || 0;
            const totalRunning = mgmt + ins + tax + repair + guaranteeAnnual + other;
            
            // „É≠„Éº„É≥Ë®àÁÆó
            const mRate = rate / 100 / 12;
            const nPay = years * 12;
            let mPay = 0;
            if (loan > 0 && mRate > 0) {
                mPay = loan * mRate * Math.pow(1 + mRate, nPay) / (Math.pow(1 + mRate, nPay) - 1);
            }
            const yPay = mPay * 12;
            
            // ÂèéÁõäË®àÁÆó
            const annual = rent * 12;
            const actualRent = annual * (1 - vacancy / 100);
            const totalInv = price + reform + totalCost;
            const profit = actualRent - totalRunning;
            const cf = profit - yPay;
            
            // Âà©Âõû„Çä
            const gross = (annual / totalInv) * 100;
            const net = (profit / totalInv) * 100;
            
            // ËøîÊ∏àÊØîÁéá
            const payRatio = (yPay / annual) * 100;
            
            // ÊäïË≥áÂõûÂèé
            const payback = totalInv / profit;
            
            currentDetailedCalc = {
                price, reform, rent, vacancy, loan, rate, years,
                landValue, totalCost, totalRunning, gross, net, 
                cf, payRatio, payback, totalInv
            };
            
            // „Ç¢„É©„Éº„Éà
            const alert = document.getElementById('paymentAlert');
            if (payRatio > 50) {
                alert.innerHTML = '<div class="alert">‚ö†Ô∏è ËøîÊ∏àÊØîÁéá„Åå50%„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇË≥áÈáëÁπ∞„Çä„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</div>';
            } else {
                alert.innerHTML = '<div class="alert alert-success">‚úì ËøîÊ∏àÊØîÁéá„ÅØÂÅ•ÂÖ®„Å™ÁØÑÂõ≤ÂÜÖ„Åß„Åô„ÄÇ</div>';
            }
            
            // Ë°®Á§∫
            document.getElementById('d_landVal').textContent = fmt(landValue);
            document.getElementById('d_gross').textContent = gross.toFixed(2) + '%';
            document.getElementById('d_net').textContent = net.toFixed(2) + '%';
            document.getElementById('d_ratio').textContent = payRatio.toFixed(1) + '%';
            document.getElementById('d_cfYear').textContent = fmt(cf);
            document.getElementById('d_cfMonth').textContent = fmt(cf / 12);
            document.getElementById('d_payback').textContent = payback.toFixed(1) + 'Âπ¥';
            document.getElementById('d_total').textContent = fmt(totalInv);
            
            document.getElementById('d_result').classList.remove('hidden');
            document.getElementById('d_result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function saveSimple() {
            const name = document.getElementById('s_name').value.trim() || 'ÂêçÂâç„Å™„Åó';
            
            if (!currentSimpleCalc) {
                alert('ÂÖà„Å´Ë®àÁÆó„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const property = {
                id: Date.now(),
                name: name,
                type: 'simple',
                simpleData: currentSimpleCalc,
                savedAt: new Date().toLocaleString('ja-JP')
            };
            
            properties.unshift(property);
            saveProperties();
            alert('‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
            switchTab('saved');
        }
        
        function saveDetailed() {
            const name = document.getElementById('d_name').value.trim() || 'ÂêçÂâç„Å™„Åó';
            
            if (!currentDetailedCalc) {
                alert('ÂÖà„Å´Ë®àÁÆó„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const property = {
                id: Date.now(),
                name: name,
                type: 'detailed',
                detailedData: currentDetailedCalc,
                savedAt: new Date().toLocaleString('ja-JP')
            };
            
            properties.unshift(property);
            saveProperties();
            alert('‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
            switchTab('saved');
        }
        
        function loadProperties() {
            const saved = localStorage.getItem('properties');
            if (saved) {
                try {
                    properties = JSON.parse(saved);
                } catch (e) {
                    properties = [];
                }
            }
        }
        
        function saveProperties() {
            localStorage.setItem('properties', JSON.stringify(properties));
        }
        
        function renderPropertyList() {
            const listElement = document.getElementById('propertyList');
            const emptyState = document.getElementById('emptyState');
            
            if (properties.length === 0) {
                listElement.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            listElement.innerHTML = '';
            
            properties.forEach((prop) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'property-item';
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'property-info';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'property-name';
                nameDiv.textContent = prop.name;
                
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'property-details';
                
                if (prop.type === 'simple' && prop.simpleData) {
                    detailsDiv.textContent = `Á∞°ÊòìË®àÁÆó | ÂÆ∂Ë≥É: ${fmt(prop.simpleData.rent)}/Êúà | Âà©Âõû„Çä: ${prop.simpleData.yield}%`;
                } else if (prop.type === 'detailed' && prop.detailedData) {
                    detailsDiv.textContent = `Ë©≥Á¥∞ÂàÜÊûê | Áâ©‰ª∂: ${fmt(prop.detailedData.price)} | Ë°®Èù¢: ${prop.detailedData.gross.toFixed(1)}% | ÂÆüË≥™: ${prop.detailedData.net.toFixed(1)}%`;
                }
                
                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(detailsDiv);
                
                const priceDiv = document.createElement('div');
                priceDiv.className = 'property-price';
                
                if (prop.type === 'simple' && prop.simpleData) {
                    priceDiv.textContent = fmt(prop.simpleData.price);
                } else if (prop.type === 'detailed' && prop.detailedData) {
                    priceDiv.textContent = fmt(prop.detailedData.totalInv);
                }
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'property-actions';
                
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn btn-secondary btn-small';
                viewBtn.textContent = 'Ë©≥Á¥∞';
                viewBtn.addEventListener('click', () => viewProperty(prop.id));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-secondary btn-small';
                deleteBtn.textContent = 'ÂâäÈô§';
                deleteBtn.style.color = '#fca5a5';
                deleteBtn.addEventListener('click', () => deleteProperty(prop.id));
                
                actionsDiv.appendChild(viewBtn);
                actionsDiv.appendChild(deleteBtn);
                
                itemDiv.appendChild(infoDiv);
                itemDiv.appendChild(priceDiv);
                itemDiv.appendChild(actionsDiv);
                
                listElement.appendChild(itemDiv);
            });
        }
        
        function viewProperty(id) {
            const property = properties.find(p => p.id === id);
            if (!property) return;
            
            let msg = `Áâ©‰ª∂Âêç: ${property.name}\n‰øùÂ≠òÊó•ÊôÇ: ${property.savedAt}\n\n`;
            
            if (property.type === 'simple' && property.simpleData) {
                const d = property.simpleData;
                msg += `„ÄêÁ∞°ÊòìË®àÁÆó„Äë\n` +
                       `ÊÉ≥ÂÆöÂÆ∂Ë≥É: ${fmt(d.rent)}/Êúà\n` +
                       `ÁõÆÊ®ôÂà©Âõû„Çä: ${d.yield}%\n` +
                       `„É™„Éï„Ç©„Éº„É†Ë≤ªÁî®: ${fmt(d.reform)}\n` +
                       `Âπ¥ÈñìÂÆ∂Ë≥É: ${fmt(d.annual)}\n` +
                       `Êé®Â•®Ë≥ºÂÖ•‰æ°Ê†º: ${fmt(d.price)}`;
            } else if (property.type === 'detailed' && property.detailedData) {
                const d = property.detailedData;
                msg += `„ÄêË©≥Á¥∞ÂàÜÊûê„Äë\n` +
                       `Áâ©‰ª∂‰æ°Ê†º: ${fmt(d.price)}\n` +
                       `Á∑èÊäïË≥áÈ°ç: ${fmt(d.totalInv)}\n` +
                       `ÂúüÂú∞ÂÄ§: ${fmt(d.landValue)}\n` +
                       `Ë°®Èù¢Âà©Âõû„Çä: ${d.gross.toFixed(2)}%\n` +
                       `ÂÆüË≥™Âà©Âõû„Çä: ${d.net.toFixed(2)}%\n` +
                       `Âπ¥ÈñìCF: ${fmt(d.cf)}\n` +
                       `ÊúàÈñìCF: ${fmt(d.cf / 12)}\n` +
                       `ËøîÊ∏àÊØîÁéá: ${d.payRatio.toFixed(1)}%\n` +
                       `ÊäïË≥áÂõûÂèé: ${d.payback.toFixed(1)}Âπ¥`;
            }
            
            alert(msg);
        }
        
        function deleteProperty(id) {
            if (!confirm('„Åì„ÅÆÁâ©‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            properties = properties.filter(p => p.id !== id);
            saveProperties();
            renderPropertyList();
        }
        
        function exportData() {
            if (properties.length === 0) {
                alert('‰øùÂ≠òÊ∏à„Åø„ÅÆÁâ©‰ª∂„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const dataStr = JSON.stringify(properties, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Áâ©‰ª∂„Éá„Éº„Çø_${new Date().toLocaleDateString('ja-JP').replace(/\//g, '')}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (!Array.isArray(imported)) {
                        throw new Error('Invalid format');
                    }
                    
                    if (confirm(`${imported.length}‰ª∂„ÅÆÁâ©‰ª∂„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºü\nÊó¢Â≠ò„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ`)) {
                        properties = imported;
                        saveProperties();
                        renderPropertyList();
                        alert('„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ');
                    }
                } catch (error) {
                    alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }
    </script>
</body>
</html>